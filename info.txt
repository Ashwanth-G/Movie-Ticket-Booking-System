

Behaviour
Auth context: Holds user, token, login, register, logout, isAuthenticated, loading. Token and user are stored in localStorage; api.js adds Authorization: Bearer <token> and on 401 clears storage and dispatches auth-logout.
Routes:
Public: /, /login, /register, /movies/:id.
Protected (must be logged in): /showtimes/:showtimeId/seats, /booking/confirm, /my-bookings.
PrivateRoute redirects unauthenticated users to /login and saves location.state.from for redirect after login.
Flow: Movies → Movie detail + showtimes → Seat selection (lock seats) → Booking confirm (pay & confirm) → Success with booking ID → My Bookings.
Seat map: Rows A–E, 10 seats per row; available (green), selected (blue), locked (yellow), booked (grey). Lock is 5 minutes; user locks then confirms.
How to run
Backend: cd backend && npm install && npm run dev (and MongoDB).
Frontend: cd frontend && npm install && npm run dev (Vite proxy to backend on port 5000).
Open http://localhost:3000; register or login, then browse movies and complete a booking.
If you want, next step can be Docker + CI/CD or README / test-report.
frontend/
├── index.html
├── vite.config.js          # Proxy /api and /health to backend
├── package.json
├── .env.example            # VITE_API_URL (optional)
├── .gitignore
└── src/
    ├── main.jsx            # BrowserRouter, AuthProvider, App
    ├── App.jsx             # Navbar + Routes
    ├── index.css           # Global styles, .btn, .card, .form-group
    ├── context/
    │   └── AuthContext.jsx # user, token, login, register, logout, loadUser
    ├── hooks/
    │   └── useAuth.js      # Re-export useAuth
    ├── services/
    │   ├── api.js          # Axios instance + auth header + 401 logout
    │   ├── authService.js  # register, login, getMe
    │   ├── movieService.js # getAll, getById
    │   ├── showtimeService.js # getByMovieId, getById, getSeats
    │   └── bookingService.js  # lockSeats, releaseLock, confirmBooking, getMyBookings, getById
    ├── components/
    │   ├── Navbar.jsx      # Links: Movies, My Bookings, Login/Register or user name + Logout
    │   ├── Navbar.css
    │   ├── PrivateRoute.jsx # Redirect to /login if not authenticated
    │   ├── SeatMap.jsx     # Rows A–E, click to select; available/locked/booked/selected
    │   └── SeatMap.css
    └── pages/
        ├── Login.jsx       # Email/password, redirect after login
        ├── Register.jsx    # Name, email, password
        ├── Auth.css
        ├── MovieList.jsx   # Grid of movies, link to /movies/:id
        ├── MovieList.css
        ├── MovieDetail.jsx # Poster, info, list of showtimes → /showtimes/:id/seats
        ├── MovieDetail.css
        ├── SeatSelection.jsx # Seat map, lock seats, then “Confirm Booking” → /booking/confirm
        ├── SeatSelection.css
        ├── BookingConfirmation.jsx # Summary, “Pay & Confirm”, then success + booking ID
        ├── BookingConfirmation.css
        ├── MyBookings.jsx  # List of user’s bookings
        └── MyBookings.css


Backend layout
backend/
├── src/│   ├── app.js              # Express app, CORS, routes, 404, errorHandler│   ├── server.js           # connectDB + listen│   ├── config/db.js        # MongoDB connection│   ├── models/             # User, Movie, Showtime, Seat, Booking, Payment│   ├── middleware/         # auth, requireRole, validate, errorHandler│   ├── services/           # authService, movieService, showtimeService, bookingService│   ├── controllers/       # auth, movie, showtime, booking│   ├── routes/             # authRoutes, movieRoutes, showtimeRoutes, bookingRoutes│   └── utils/              # errors, constants├── scripts/seedAdmin.js    # Create admin user (admin@example.com / admin123)├── __tests__/              # health.test.js, auth.test.js├── Dockerfile├── jest.config.js├── package.json└── .env.example
API overview
Method	Path	Auth	Description
Auth			
POST	/api/auth/register	No	Register (body: email, password, name)
POST	/api/auth/login	No	Login (body: email, password)
GET	/api/auth/me	JWT	Current user profile
Movies			
GET	/api/movies	No	List movies (?active=false for all)
GET	/api/movies/:id	No	Movie by ID
POST	/api/movies	Admin	Create movie
PUT	/api/movies/:id	Admin	Update movie
DELETE	/api/movies/:id	Admin	Delete movie
Showtimes			
GET	/api/showtimes/movie/:movieId	No	Showtimes for movie
GET	/api/showtimes/:id	No	Showtime by ID
GET	/api/showtimes/:showtimeId/seats	No	Seat map (releases expired locks first)
POST	/api/showtimes	Admin	Create showtime (creates default seats A–E × 10)
PUT	/api/showtimes/:id	Admin	Update showtime
DELETE	/api/showtimes/:id	Admin	Delete showtime
Bookings			
POST	/api/bookings/lock	JWT	Lock seats (body: showtimeId, seatIds[])
POST	/api/bookings/release	JWT	Release lock (body: showtimeId, seatIds[])
POST	/api/bookings/confirm	JWT	Confirm booking (body: showtimeId, seatIds[], totalAmount?)
GET	/api/bookings/my	JWT	Current user’s bookings
GET	/api/bookings/:bookingId	JWT	Booking by ID (owner or admin)
Behaviour
Auth: JWT in Authorization: Bearer <token>, bcrypt for passwords, roles user and admin.
Seat locking: Statuses available → locked → booked. Lock timeout 5 minutes; expired locks are released when fetching seats or locking/confirming. Atomic updates to avoid double booking.
Showtime creation: Creates a default seat map (rows A–E, 10 seats per row).
Validation: express-validator on auth, movies, showtimes, bookings.
Admin: Create an admin with npm run seed:admin (default: admin@example.com / admin123).
How to run
Copy .env.example to .env and set MONGODB_URI, JWT_SECRET, etc.
Start MongoDB, then:
npm install
npm run dev (or npm start)
npm run seed:admin to create an admin user
npm test to run Jest (uses MONGODB_URI or mongodb://localhost:27017/movie-booking-test).1. Architecture

1. Architecture
docs/ARCHITECTURE.md
High-level system: Client (React SPA) → API/Proxy → Express backend (Routes, Controllers, Services, Middleware, Mongoose) → MongoDB.
Backend layout: config, controllers, models, routes, middleware, services, utils.
Frontend layout: components, pages, services, hooks.
Auth: JWT, roles (user/admin), protected routes.
Seat locking: statuses available | locked | booked, 5‑minute timeout, atomic updates, release on failure.
DevOps: Docker, CI/CD, deployment.
Security: bcrypt, validation, CORS, no secrets in code.
docs/FLOW.md
Auth flow: register/login → JWT → store token.
Booking flow: movies → movie details → showtimes → seats → lock → confirm → confirmation / My Bookings.
Seat lock flow: lock request → atomic update → timeout/release.
Admin flows: movie/showtime CRUD behind admin-only routes.
Diagrams
docs/architecture-diagram.mmd – Mermaid source for system/backend architecture.
docs/flow-diagram.mmd – Mermaid source for user booking flow.
docs/README.md – How to export these to architecture-diagram.png and flow-diagram.png (Mermaid Live or mmdc).
2. Database design
docs/DATABASE-DESIGN.md
users: email (unique), password (bcrypt), name, role (user/admin), timestamps. Index: email.
movies: title, genre, duration, language, description, poster, isActive, timestamps. Indexes: title, isActive.
showtimes: movieId (ref), theatre, screen, date, startTime, timestamps. Indexes: movieId, compound movieId + date + startTime.
seats: showtimeId (ref), row, number, status (available | locked | booked), lockedAt, lockedBy (ref User), timestamps. Indexes: showtimeId, unique compound showtimeId + row + number, showtimeId + status.
bookings: bookingId (unique), userId, showtimeId, seatIds[], status, totalAmount, timestamps. Indexes: bookingId, userId, showtimeId, userId + createdAt.
payments (mock): bookingId (ref), amount, status, method, createdAt. Index: bookingId.
Relationships and references (ObjectId) are documented.
Seat locking and concurrency are described (atomic lock/unlock/book).
3. Project structure (docs only so far)
/movie-ticket-booking  (workspace: MovieTicketBookingSystem) └── docs      ├── ARCHITECTURE.md      ├── DATABASE-DESIGN.md      ├── FLOW.md      ├── README.md      ├── architecture-diagram.mmd      └── flow-diagram.mmd
Generated images from the tool were saved under Cursor’s assets path. To have PNGs inside the repo, use the Mermaid files as in docs/README.md:
npx mmdc -i docs/architecture-diagram.mmd -o docs/architecture-diagram.pngnpx mmdc -i docs/flow-diagram.mmd -o docs/flow-diagram.png

1. Architecture
docs/ARCHITECTURE.md
High-level system: Client (React SPA) → API/Proxy → Express backend (Routes, Controllers, Services, Middleware, Mongoose) → MongoDB.
Backend layout: config, controllers, models, routes, middleware, services, utils.
Frontend layout: components, pages, services, hooks.
Auth: JWT, roles (user/admin), protected routes.
Seat locking: statuses available | locked | booked, 5‑minute timeout, atomic updates, release on failure.
DevOps: Docker, CI/CD, deployment.
Security: bcrypt, validation, CORS, no secrets in code.
docs/FLOW.md
Auth flow: register/login → JWT → store token.
Booking flow: movies → movie details → showtimes → seats → lock → confirm → confirmation / My Bookings.
Seat lock flow: lock request → atomic update → timeout/release.
Admin flows: movie/showtime CRUD behind admin-only routes.
Diagrams
docs/architecture-diagram.mmd – Mermaid source for system/backend architecture.
docs/flow-diagram.mmd – Mermaid source for user booking flow.
docs/README.md – How to export these to architecture-diagram.png and flow-diagram.png (Mermaid Live or mmdc).

2. Database design
docs/DATABASE-DESIGN.md
users: email (unique), password (bcrypt), name, role (user/admin), timestamps. Index: email.
movies: title, genre, duration, language, description, poster, isActive, timestamps. Indexes: title, isActive.
showtimes: movieId (ref), theatre, screen, date, startTime, timestamps. Indexes: movieId, compound movieId + date + startTime.
seats: showtimeId (ref), row, number, status (available | locked | booked), lockedAt, lockedBy (ref User), timestamps. Indexes: showtimeId, unique compound showtimeId + row + number, showtimeId + status.
bookings: bookingId (unique), userId, showtimeId, seatIds[], status, totalAmount, timestamps. Indexes: bookingId, userId, showtimeId, userId + createdAt.
payments (mock): bookingId (ref), amount, status, method, createdAt. Index: bookingId.
Relationships and references (ObjectId) are documented.
Seat locking and concurrency are described (atomic lock/unlock/book).
3. Project structure (docs only so far)
/movie-ticket-booking  (workspace: MovieTicketBookingSystem) └── docs      ├── ARCHITECTURE.md      ├── DATABASE-DESIGN.md      ├── FLOW.md      ├── README.md      ├── architecture-diagram.mmd      └── flow-diagram.mmd
Generated images from the tool were saved under Cursor’s assets path. To have PNGs inside the repo, use the Mermaid files as in docs/README.md:
npx mmdc -i docs/architecture-diagram.mmd -o docs/architecture-diagram.pngnpx mmdc -i docs/flow-diagram.mmd -o docs/flow-diagram.png
